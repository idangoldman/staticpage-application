{% extends 'page/_base.html' %}
{% set title = search_results_title %}
{% set description = search_results_description %}

{% block head %}
    {{ super() }}

    <style type="text/css" class="css-intervention">

        {% set google_fonts = ("Arvo", "Lato", "Lora", "Merriweather", "Merriweather Sans", "Noticia Text", "Open Sans", "Playfair Display", "Roboto", "Source Sans Pro") %}
        {% if design_font_family is not none %}
            {% for google_font in google_fonts %}
                {% set font_family = design_font_family.split(', ')[0] %}
                {% if font_family is equalto google_font %}
                    {% set font_family = font_family.split(' ') %}
        @import url("//fonts.googleapis.com/css?family={{ font_family | join('+') }}:400,600,700,800&subset=latin");
                {% endif %}
            {% endfor %}
        {% endif %}

        body {
            direction: {{ design_content_direction }};
        }

        body, button, input, select, textarea {
            font-family: {{ design_font_family }};
            color: {{ design_font_color }};
        }

        .background {
            background-color: {{ design_background_color }};
            background-repeat: {{ design_background_repeat }};
            background-size: {{ 'cover' if design_background_repeat == 'no-repeat' else 'auto' }};

            {% if design_background_image %}
            background-image: url('{{ design_background_image }}');
            {% endif %}
        }

        .page {
            text-align: {{ design_content_alignment }};
        }

        .logo {
            {% if design_content_alignment == "left" %}
            margin-left: 0;
            margin-right: auto;
            {% elif design_content_alignment == "right" %}
            margin-left: auto;
            margin-right: 0;
            {% else %}
            margin-left: auto;
            margin-right: auto;
            {% endif %}
        }
    </style>

    {% if design_additional_styles %}
        <style type="text/css" class="css-additional">
            {{ design_additional_styles }}
        </style>
    {% endif %}

{% endblock head %}

{% block content %}
    <article class="content">
        {% if content_logo %}
        <img class="logo" src="{{ content_logo }}" />
        {% endif %}

        {% if is_intervention or content_title %}
        <h1 class="title">{{ content_title }}</h1>
        {% endif %}

        {% if is_intervention or content_sub_title %}
        <h2 class="sub-title">{{ content_sub_title }}</h2>
        {% endif %}

        {% if is_intervention or count_down_datetime %}
        <div class="count-down-clock">
            <span class="time">
                <strong class="unit" id="days">00</strong>
                <i class="label">days</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="hours">00</strong>
                <i class="label">hours</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="minutes">00</strong>
                <i class="label">minutes</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="seconds">00</strong>
                <i class="label">seconds</i>
            </span>
        </div>
        {% endif %}

        {% if is_intervention or content_description %}
        <p class="description">{{ content_description }}</p>
        {% endif %}

    </article>
{% endblock %}

{% block footer %}
    {{ super() }}

    {% if google_analytics_code %}
    {% from 'macros/3rd-party.html' import google_analytics %}
    {{ google_analytics( google_analytics_code ) }}
    {% endif %}

    {% if is_intervention or count_down_datetime %}
    <script>
        var countDownData = {
            'datetime': '{{ count_down_datetime_with_timezone }}',
            'redirectURL': '{{ count_down_redirect_url }}'
        },
            countDownTimeoutID = null;

        function countDownClock() {
            var deadlineTimestamp = new Date( countDownData.datetime ).getTime(),
                nowTimestamp = new Date().getTime(),
                deltaTimestamp = deadlineTimestamp - nowTimestamp;

            if ( 0 <= deltaTimestamp && 0 !== countDownTimeoutID ) {
                var clock = {
                    'seconds': Math.floor( ( deltaTimestamp / 1000 ) % 60 ),
                    'minutes': Math.floor( ( deltaTimestamp / 1000 / 60 ) % 60 ),
                    'hours': Math.floor( ( deltaTimestamp / ( 1000 * 60 * 60 ) ) % 24 ),
                    'days': Math.floor( deltaTimestamp / ( 1000 * 60 * 60 * 24 ) )
                };

                for ( var unit in clock ) {
                    var time_unit = clock[ unit ] < 10 ? '0' + clock[ unit ] : clock[ unit ]; // adding zero
                    document.getElementById( unit ).innerHTML = time_unit;
                }

                countDownTimeoutID = setTimeout( function() { countDownClock() }, 1000 );
            } else {
                var clock = {
                    'seconds': 0,
                    'minutes': 0,
                    'hours': 0,
                    'days': 0
                };

                for ( var unit in clock ) {
                    var time_unit = clock[ unit ] < 10 ? '0' + clock[ unit ] : clock[ unit ]; // adding zero
                    document.getElementById( unit ).innerHTML = time_unit;
                }

                console.log("it's over");
                countDownTimeoutID = clearTimeout( countDownTimeoutID );

                if ( countDownData.redirectURL.length ) {
                    window.location.href = countDownData.redirectURL;
                }
            }

        }

        countDownClock();

    </script>
    {% endif %}

    {% if is_intervention %}
        <script src="{{ url_for('static', filename='page-intervention.js') }}"></script>
    {% endif %}
{% endblock %}
