{% extends 'page/_base.html' %}
{% set title = search_results_title %}
{% set description = search_results_description %}

{% block head %}
    {{ super() }}

    <style type="text/css" class="css-intervention">

        {% set google_fonts = ("Arvo", "Lato", "Lora", "Merriweather", "Merriweather Sans", "Noticia Text", "Open Sans", "Playfair Display", "Roboto", "Source Sans Pro") %}
        {% if design_font_family is not none %}
            {% for google_font in google_fonts %}
                {% set font_family = design_font_family.split(', ')[0] %}
                {% if font_family is equalto google_font %}
                    {% set font_family = font_family.split(' ') %}
        @import url("//fonts.googleapis.com/css?family={{ font_family | join('+') }}:400,600,700,800&subset=latin");
                {% endif %}
            {% endfor %}
        {% endif %}

        body {
            direction: {{ design_content_direction }};
        }

        body, button, input, select, textarea {
            font-family: {{ design_font_family }};
            color: {{ design_font_color }};
        }

        .background {
            background-color: {{ design_background_color }};
            background-repeat: {{ design_background_repeat }};
            background-size: {{ 'cover' if design_background_repeat == 'no-repeat' else 'auto' }};

            {% if design_background_image %}
            background-image: url('{{ design_background_image }}');
            {% endif %}
        }

        .page {
            text-align: {{ design_content_alignment }};
        }

        .logo {
            {% if design_content_alignment == "left" %}
            margin-left: 0;
            margin-right: auto;
            {% elif design_content_alignment == "right" %}
            margin-left: auto;
            margin-right: 0;
            {% else %}
            margin-left: auto;
            margin-right: auto;
            {% endif %}
        }
    </style>

    {% if design_additional_styles %}
        <style type="text/css" class="css-additional">
            {{ design_additional_styles }}
        </style>
    {% endif %}

{% endblock head %}

{% block content %}
    <article class="content">
        {% if content_logo %}
        <img class="logo" src="{{ content_logo }}" />
        {% endif %}

        {% if is_intervention or content_title %}
        <h1 class="title">{{ content_title }}</h1>
        {% endif %}

        {% if is_intervention or content_sub_title %}
        <h2 class="sub-title">{{ content_sub_title }}</h2>
        {% endif %}

        {% if is_intervention or count_down_datetime %}
        <div class="count-down-clock">
            <span class="time">
                <strong class="unit" id="days">00</strong>
                <i class="label">days</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="hours">00</strong>
                <i class="label">hours</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="minutes">00</strong>
                <i class="label">minutes</i>
            </span>
            <span class="separator">:</span>
            <span class="time">
                <strong class="unit" id="seconds">00</strong>
                <i class="label">seconds</i>
            </span>
        </div>
        {% endif %}

        {% if is_intervention or content_description %}
        <p class="description">{{ content_description }}</p>
        {% endif %}

    </article>
{% endblock %}

{% block footer %}
    {{ super() }}

    {% if google_analytics_code %}
    {% from 'macros/3rd-party.html' import google_analytics %}
    {{ google_analytics( google_analytics_code ) }}
    {% endif %}

    {% if is_intervention or count_down_datetime %}
    <script>
        function add_zero( unit ) {
            return unit < 10 ? '0' + unit : unit;
        }

        function redirect( url ) {
            if ( url.trim().length ) {
                window.location.href = url;
            }
        }

        function countDownClock( datetime, redirectURL ) {
            this.countDownTimeoutID = null;
            this.datetime = datetime || new Date();
            this.redirectURL = redirectURL || '';
            this.node = document.querySelector('.count-down-clock');

            this.tick = function() {
                var deadlineTimestamp = new Date( this.datetime ).getTime(),
                    nowTimestamp = new Date().getTime(),
                    deltaTimestamp = deadlineTimestamp - nowTimestamp;

                this.node.style.display = 'block';

                if ( 0 <= deltaTimestamp && 0 !== this.countDownTimeoutID ) {
                    this.render( this.clock( deltaTimestamp ) );
                    this.countDownTimeoutID = setTimeout( function() { this.tick() }, 1000 );
                } else if ( 0 >= deltaTimestamp ) {
                    this.render( this.clock( 0 ) );
                    this.countDownTimeoutID = clearTimeout( this.countDownTimeoutID );

                    redirect( this.redirectURL );
                }
            };

            this.update = function( datetime ) {
                this.datetime = datetime;
                this.countDownTimeoutID = null;
            };

            this.stop = function() {
                this.countDownTimeoutID = 0;
                this.node.style.display = 'none';
            };

            this.clock = function( timestamp ) {
                return {
                    'seconds': Math.floor( ( timestamp / 1000 ) % 60 ),
                    'minutes': Math.floor( ( timestamp / 1000 / 60 ) % 60 ),
                    'hours': Math.floor( ( timestamp / ( 1000 * 60 * 60 ) ) % 24 ),
                    'days': Math.floor( timestamp / ( 1000 * 60 * 60 * 24 ) )
                };
            };

            this.render = function( clock ) {
                for ( var unit in clock ) {
                    document.getElementById( unit ).innerHTML = add_zero( clock[ unit ] );
                }
            };

            return this;
        }

        var countDown = countDownClock(
                '{{ count_down_datetime_with_timezone | default('') }}', '{{ count_down_redirect_url | default('') }}'
            )
            countDown.tick();
    </script>
    {% endif %}

    {% if is_intervention %}
        <script src="{{ url_for('static', filename='page-intervention.js') }}"></script>
    {% endif %}
{% endblock %}
